<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>ê¸´ ê¸€ ìš”ì•½ê¸°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        #status { font-weight: bold; margin-bottom: 1rem; }
        #status.online { color: green; }
        #status.offline { color: red; }
        #charCount {
        text-align: right;
        font-size: 0.9rem;
        color: #666;
        }
    </style>
</head>
<body class="container my-5">
    <h1 class="mb-4">ğŸ“ ê¸´ ê¸€ ìš”ì•½í•˜ê¸°</h1>

    <div class="mb-3">
        <label for="t" class="form-label">ìš”ì•½í•  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”:</label>
        <textarea class="form-control" id="t" rows="10" oninput="c()"></textarea>
        <div id="charCount">í˜„ì¬ ì…ë ¥: 0ì</div>
    </div>

    <button class="btn btn-primary" onclick="s()">ìš”ì•½í•˜ê¸°</button>

    <div id="resultBox" class="mt-4" style="display: none;">
        <h4>ğŸ“Œ ìš”ì•½ ê²°ê³¼:</h4>
        <p id="r" class="border p-3 bg-light rounded"></p>

        <button class="btn btn-secondary mt-2" onclick="readSummary()">ğŸ“¢ ìš”ì•½ ë“£ê¸°</button>
    </div>

    <script>
    const MAX_CHARS = 1000;

    function c() {
        const textarea = document.getElementById("t");
        let value = textarea.value;

        if (value.length > MAX_CHARS) {
            textarea.value = value.slice(0, MAX_CHARS);
        }

        document.getElementById("charCount").textContent = "í˜„ì¬ ì…ë ¥: " + textarea.value.length + "ì";
    }

    async function s() {
        const v = document.getElementById("t").value.trim();
        const r = document.getElementById("r");
        const resultBox = document.getElementById("resultBox");

        resultBox.style.display = "block";

        if (v.length === 0) {
        r.innerHTML = "<span style='color: red;'>â— ìš”ì•½í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.</span>";
        return;
        }

        r.textContent = "ìš”ì•½ì¤‘...";

        try {
        const res = await fetch("/summarize", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ text: v })
        });

        const d = await res.json();

        if (res.ok && d.summary) {
            r.textContent = d.summary;
        } else {
            r.innerHTML = "<span style='color: red;'>âŒ ìš”ì•½ ì‹¤íŒ¨: " + (d.error || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜") + "</span>";
        }
        } catch {
        r.innerHTML = "<span style='color: red;'>âŒ ìš”ì²­ ì‹¤íŒ¨: ì„œë²„ì™€ì˜ ì—°ê²°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.</span>";
        }
    }

    function readSummary() {
        const summaryText = document.getElementById("r").textContent;

        if (!summaryText || summaryText.includes("âŒ") || summaryText === "ìš”ì•½ì¤‘...") {
        return;
        }

        const utterance = new SpeechSynthesisUtterance(summaryText);
        utterance.lang = "ko-KR";
        speechSynthesis.speak(utterance);
    }
    </script>
</body>
</html>
